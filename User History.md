# User History extraídas do código

| ID da User History | User History | Entradas do Usuário | Saídas do Sistema |
|---|---|---|---|
| 1 | Como visitante, quero registrar uma conta fornecendo nome, email e senha para poder autenticar-me no sistema. | { name, email, password, role? } | Sucesso: 201 + usuário (sem senha). Falha: 400 + { error: 'name, email and password are required' } ou 'User already exists'. |
| 2 | Como usuário, quero fazer login com email e senha para receber um token JWT que me autorize a usar endpoints protegidos. | { email, password } | Sucesso: 200 + { token, user } (token com { id, email, role } expira em 8h). Falha: 400/401 + { error: 'Invalid credentials' / 'email and password required' }. |
| 3 | Como operador do sistema, preciso ter um admin padrão criado na inicialização caso não existam usuários, para poder gerenciar o sistema imediatamente. | (nenhuma ação do usuário) | Admin padrão criado em memória com email `admin@hotel.local` e senha `admin123`. |
| 4 | Como usuário autenticado, quero visualizar a lista de quartos disponíveis para que eu possa escolher onde reservar. | Header Authorization: Bearer <token> | Sucesso: 200 + array de quartos (cada um com disponibilidade). Se token ausente/ inválido: 401/403 + { error }. |
| 5 | Como admin, quero criar quartos (type, price, capacity) para disponibilizá-los no sistema. | { type, price, capacity } + token admin | Sucesso: 201 + objeto room (available:true). Falha: 400 + { error } ou 403 se não for admin. |
| 6 | Como usuário autenticado, quero criar uma reserva informando roomId, startDate e endDate para garantir minha estadia; o sistema deve impedir reserva se o quarto não existir ou já estiver ocupado. | { roomId, startDate, endDate } + token (userId implícito do token) | Sucesso: 201 + booking (status: 'active') e room.available -> false. Falha: 400 + mensagens ('userId, roomId, startDate and endDate required', 'Room not found', 'Room not available'). |
| 7 | Como usuário autenticado, quero ver minhas reservas para acompanhar as minhas estadias. | token válido | Sucesso: 200 + lista de bookings onde booking.userId === req.user.id. |
| 8 | Como admin, quero listar todas as reservas para auditar e gerenciar o sistema. | token admin | Sucesso: 200 + todas as reservas (endpoint GET /reservations retorna tudo para admin). |
| 9 | Como usuário que fez uma reserva, quero cancelar minha reserva para liberar o quarto caso meus planos mudem. | DELETE /reservations/{id} + token (req.user.id) | Sucesso: 200 + booking com status 'cancelled' e room.available -> true. Falha: 400 + 'Booking not found' ou 'Not allowed to cancel this booking' ou 'Booking already cancelled'. |
| 10 | Como admin, quero poder cancelar qualquer reserva para intervir quando necessário. | DELETE /reservations/{id} + token admin | Sucesso: 200 + booking status 'cancelled'. |
| 11 | Como usuário, quero registrar um pagamento associado a uma reserva com valor para completar a operação financeira. | { bookingId, userId, amount } + token | Sucesso: 201 + payment (status: 'pending'). Falha: 400 + 'bookingId, userId and amount required'. |
| 12 | Como usuário, quero consultar meus pagamentos para verificar o status (pendente/confirmado/cancelado). | token válido | Sucesso: 200 + lista de payments filtrada por userId === req.user.id. |
| 13 | Como admin, quero atualizar o status de um pagamento para confirmar ou cancelar um pagamento quando apropriado. | PATCH /payments/{id} { status } + token admin | Sucesso: 200 + pagamento atualizado. Falha: 400 + 'Payment not found' ou 'Invalid status'; 403 se não for admin. |
| 14 | Como desenvolvedor/operador, quero que as senhas sejam armazenadas de forma segura para reduzir risco de vazamento. | password plain ao registrar | Senha armazenada como hash (bcrypt). Ao retornar usuário na API, a senha é omitida. |
| 15 | Como usuário, quero mensagens de erro claras quando algo falhar (dados obrigatórios ausentes, credenciais inválidas etc.) para entender o que preciso corrigir. | Requisições inválidas / token ausente / ação não permitida | Respostas com códigos HTTP adequados (400, 401, 403) e corpo { error: '<mensagem>' } explicando o problema. |

> Observação: as User History foram extraídas do comportamento real implementado nos controllers, serviços e middleware do projeto. Elas descrevem o que o usuário (ou admin) espera obter ao interagir com a API atualmente.
